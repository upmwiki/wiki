---
prev:
    text: Эконометрические модели
    link: ../02/
next: false
---

**Математические модели в экономике**

# Корреляционный анализ количественных зависимостей

<p class="subtext">8 сентября 2025 · лекция</p>

В прикладных задачах часто нужно понять: связаны ли две случайные величины?

Примеры:

* часы подготовки к экзамену $\leftrightarrow$ итоговый балл;
* температура воздуха $\leftrightarrow$ потребление электроэнергии;
* доход $\leftrightarrow$ расходы.

**Корреляционный анализ** — это инструментарий для измерения тесноты и направления связи между переменными.

## Коэффициент корреляции Пирсона

При изучении связи между факторами сразу возникает вопрос: в какой степени две переменные *совместно изменяются*? (т. е., влечёт ли за собой увеличение одной переменной увеличение или уменьшение другой, или не влечёт.)

<figure>
    <img width="60%" src="/media/images/mmeconomics_1.png" />
</figure>

Представляет интерес наклон (**направление связи**) и ширина (**сила связи**) воображаемого эллипса.

Тесноту *линейной* связи между двумя факторами обычно измеряют при помощи **коэффициента корреляции Пирсона:**

$$
r^*_{XY} = {\overline{xy} - \bar{x} \cdot \bar{y} \over \sqrt{D^*_x} \cdot \sqrt{D^*_y}}
$$

Известно, что

$$
-1 \le r^*_{XY} \le 1
$$

и *линейная зависимость между $X$ и $Y$* тем сильнее, чем ближе *модуль коэффициента корреляции* к 1.

::: info Пример

| $X/Y$ | $-1$ | $0$ | $2$ |
|-|-|-|-|
| $0-20$ | $5$ | $3$ | $4$ |
| $20-40$ | $2$ | $1$ | $5$ |

$$
\bar{x} = {10 \cdot 12 + 30 \cdot 8 \over 20} = {360 \over 20} = 18;
$$

$$
\bar{y} = {-1 \cdot 7 + 0 \cdot 4 + 2 \cdot 9 \over 20} = {11 \over 20} = 0,55;
$$

$$
\overline{x^2} = {10^2 \cdot12 + 30^2 \cdot 8 \over 20} = {8400 \over 20} = 420;
$$

$$
D^*_x = \overline{x^2} - (\bar{x})^2 = 420 - 18^2 = 96;
$$

$$
\overline{y^2} = {(-1)^2 \cdot 7 + 0^2 \cdot 4 + 2^2 \cdot 9 \over 20} = {43 \over 20} = 2,15;
$$

$$
D^*_y = \overline{y^2} - (\bar{y})^2 = 2,15 - 0,55^2 = 1,8475;
$$

$$
\overline{xy} = {10 \cdot (-1) \cdot 5 + 10 \cdot 3 \cdot 0 + 10 \cdot 4 \cdot 2 + 30 \cdot 2 \cdot (-1) + 30 \cdot 1 \cdot 0 + 30 \cdot 5 \cdot 2 \over 20} =
$$

$$
= {270 \over 20} = 13,5;
$$

$$
r^*_{XY}
= {\overline{xy} - \bar{x} \cdot \bar{y} \over \sqrt{D^*_x} \sqrt{D^*_y}}
= {13,5 - 18 \cdot 0,55 \over \sqrt{96} \sqrt{1,8475}}
\approx {3,6 \over 9,79 \cdot 1,36 }
\approx 0,27.
$$
:::

### Почему именно такая формула?

**Ковариация** $Cov(X,Y)$ — это мера совместного отклонения двух переменных от своих средних:

$$
Cov(X,Y) = \overline{(X - \bar{X})(Y - \bar{Y})} = \overline{XY} - \bar{X} \cdot \bar{Y}.
$$

Если $X$ и $Y$ одновременно выше или ниже среднего — ковариация положительна. Если одна выше, другая ниже — отрицательна.

Но ковариация *зависит от масштаба*. Например, если измерять рост в метрах или сантиметрах — ковариация изменится в 100 раз. Чтобы сделать меру безразмерной и сравнимой. делим ковариацию на произведение стандартных отклонений:

$$
r = {Cov(X,Y) \over \sqrt{D^*_x} \sqrt{D^*_y}}.
$$

Теперь:

* $r \in [-1; 1]$;
* не зависит от единиц измерения;
* интерпретируем: близость к $\pm 1$ — сильная линейная связь.

### Геометрическая интерпретация

Представим выборку как векторы в $\mathbb{R}^n$:

$$
x = (x_1, x_2, ..., x_n),
$$

$$
y = (y_1, y_2, ..., y_n).
$$

Центрируем их: вычитаем среднее — получаем векторы

$$
x_c = (x_1 - \bar{x}, x_2 - \bar{x}, ..., x_n - \bar{x}),
$$

$$
y_c = (y_1 - \bar{y}, y_2 - \bar{y}, ..., y_n - \bar{y}).
$$

Тогда

$$
r = {x_c \cdot y_c \over ||x_c|| \cdot ||y_c||} = \cos \theta,
$$

где $\theta$ — угол между векторами.

Таким образом, коэффициент корреляции — это косинус угла между центрированными векторами данных.

* Если $r = 1$, то векторы сонаправлены (идеальная положительная линейная связь).
* Если $r = -1$, то противоположно направлены.
* Если $r = 0$, то векторы ортогональны (нет линейной связи).

Это объясняет, почему корреляция измеряет линейную связь: она отражает, до какой степени данные близки к прямой.

---

Корреляцию лучше всего использовать для переменных, которые демонстрируют приближённо линейную зависимость между собой. Соответствие данных может быть визуально представлено в виде диаграммы рассеяния. При помощи диаграммы рассеяния мы можем оценить связь между переменными и определить, коррелируют они или нет.

<figure>
    <img width="75%" src="/media/images/mmeconomics_2.png" />
</figure>

Вот некоторые диаграммы рассеивания вместе с выборочным коэффициентом корреляции:

<figure>
    <img width="75%" src="/media/images/mmeconomics_3.png" />
</figure>

::: info Пример
Джон — инвестор. Его портфель в основном отслеживает показатели S&P 500, и Джон хочет добавить акции Apple Inc. Прежде чем добавить Apple в свой портфель, он хочет оценить корреляцию между акциями и S&P 500, чтобы убедиться, что добавление акций не увеличит систематический риск его портфеля. Чтобы найти коэффициент, Джон собрал информацию за пять лет:

| | S&P 500 | Apple |
|-|-|-|
| 2013 | 1691.75 | 68.96 |
| 2014 | 1977.80 | 100.11 |
| 2015 | 1884.09 | 109.06 |
| 2016 | 2151.13 | 112.18 |
| 2017 | 2519.36 | 154.12 |

Рассчитанный по двум последним столбцам коэффициент $r = 0,95$ показывает, что цены S&P 500 и Apple Inc. имеют высокую положительную корреляцию. Это означает, что их соответствующие цены имеют тенденцию двигаться в одном направлении. Поэтому добавление Apple в портфель фактически увеличит уровень систематического риска.
:::

### Замечания о коэффициенте корреляции

1. Коэффициент корреляции оценивает только *линейную* связь переменных. Он не покажет наличие нелинейной связи.

   <figure>
       <img width="50%" src="/media/images/mmeconomics_4.png" />
       <figcaption>Здесь связь переменных есть, и она очень сильная, но <i>r<sub>XY</sub></i> = 0.</figcaption>
   </figure>

2. Необходимо, чтобы у переменных была значительная изменчивость. Если сформулировать выборку изначально однотипных по одному из рассматриваемых факторов, нечего надеяться выявить там кореляцию фактора с другими.

   <figure>
       <img width="65%" src="/media/images/mmeconomics_5.png" />
   </figure>

3. Коэффициент корреляции очень чувствителен к выбросам.

::: tip Важное замечание
Корреляция совершенно не подразумевает наличие причинно-следственной связи.

Если две переменные коррелируют, это не означает, что одна переменная вызывает изменения в другой переменной. Могут существовать другие факторы, обуславливающие эти взаимосвязи.

Зная только коэффициент корреляции, нельзя сколько-нибудь детально описать зависимость.

<figure>
    <img width="80%" src="/media/images/mmeconomics_6.png" />
</figure>
:::

### Матрица корреляций

:::: info Пример
Для следующих данных составить корреляционную матрицу:

| $y$ | $x_1$ | $x_2$ |
|-|-|-|
| $7$ | $2$ | $3$ |
| $14$ | $2$ | $4$ |
| $11$ | $5$ | $7$ |
| $12$ | $7$ | $10$ |

::: info Решение
1. Составляем матрицу:

   $$
   M = \begin{pmatrix}
    7 & 2 & 3 \\
    14 & 2 & 4 \\
    11 & 5 & 7 \\
    12 & 7 & 10
   \end{pmatrix}.
   $$

2. Из каждого столбца вычитаем его среднее значение (например, из второго столбца вычитаем $4$):

   $$
   M_1 = \begin{pmatrix}
    -4 & -2 & -3 \\
    3 & -2 & -2 \\
    0 & 1 & 1 \\
    1 & 3 & 4
   \end{pmatrix}.
   $$

3. Умножаем $M_1^T$ на $M_1$ и делим на $n$ (здесь $n = 4$), получаем **матрицу ковариаций:**
   
   $$
   M_1^T \cdot M_1
   = \begin{pmatrix}
    -4 & 3 & 0 & 1 \\
    -2 & -2 & 1 & 3 \\
    -3 & -2 & 1 & 4
   \end{pmatrix} \cdot \begin{pmatrix}
    -4 & -2 & -3 \\
    3 & -2 & -2 \\
    0 & 1 & 1 \\
    1 & 3 & 4
   \end{pmatrix} / 4
   = \begin{pmatrix}
    6,5 & 1,25 & 2,5 \\
    1,25 & 4,5 & 5,75 \\
    2,5 & 5,75 & 7,5
   \end{pmatrix}.
   $$

   На диагонали стоят *выборочные дисперсии*, например, $\mathbb{D}y = 6,5$.

4. Делим каждое число на корень из произведения соответствующих дисперсий(например, $1,25$ на корень из $6,5 \cdot 4,5$; $2,5$ на корень из $6,5 \cdot 7,5$), получаем **матрицу корреляций:**
   
   $$
   r \approx \begin{pmatrix}
    1 & 0,2311 & 0,3581 \\
    0,2311 & 1 & 0,9898 \\
    0,3581 & 0,9898 & 1
   \end{pmatrix}.
   $$
:::
::::

В MS Excel для вычисления корреляционных матриц используется инструмент *Корреляция* из надстройки *Анализ данных*.

<!-- <figure>
    <img width="50%" src="/media/images/mmeconomics_7.png" />
</figure> -->

1. Вызвать надстройку *Сервис* (или вкладка *Данные*) — *Анализ данных*.
2. В появившемся списке *Инструменты анализа* выбрать строку *Корреляция* и нажать кнопку ОК.
3. В появившемся окне укзаать *Входной интервал*.
4. Установить переключатель в разделе *Группировка* ("по столбцам" или "по строкам").

В выходной диапазон будет выведена корреляционная матрица.

### Частная корреляция

Корреляция между двумя переменными, вычисленная после устранения всех других переменных, называется **частной корреляцией**.

*Частный коэффициент корреляции* между переменными $X$ и $Y$ при исключении влияния переменной $Z$ вычисляется по формуле

$$
r_{XY|Z} = {r_{XY} - r_{XZ} r_{YZ} \over \sqrt{
    \left( 1 - r_{XZ}^2 \right) \left( 1 - r_{YZ}^2 \right)
}}.
$$

> Не дописано.

## Коэффициент ранговой корреляции Спирмена

Коэффициент Спирмена — это *непараметрическая* мера корреляции, которая оценивает силу и направление монотонной (не обязательно линейной) связи между двумя переменными. Он основан на ранжировании данных, а не на их абсолютных значениях.

Это делает его полезным для *порядковых* данных или когда распределение переменных *не нормальное*, есть выбросы или данные *нелинейны*, но сохраняют *монотонность* (т. е. когда одна переменная растёт, вторая тоже растёт или падает последовательно).

### Формула расчёта

Для двух наборов данных $X$ и $Y$ с $n$ наблюдениями:

1. Присвойте ранги $R_i$ и $S_i$ каждому значению $X$ и $Y$ (ранг $1$ — наименьшему, ранг $n$ — наибольшему). Если есть одинаковые значения (связи), присвойте средний ранг (например, два одинаковых значения на 3-м и 4-м месте получают ранг 3,5).
2. Вычислите разницы рангов $d_i = \text{ранг}_{X_i} - \text{ранг}_{Y_i}$ для каждого $i$.
3. Используйте формулу:

   $$
   \rho = 1 - {6 \over n \left(n^2 - 1\right)} \sum_{i=1}^n d_i^2.
   $$

Эта формула работает для данных без связей (совпадений) или с небольшим их количеством.

Для данных с многими связями используется корректированная версия, но для простоты нередко применяют базовую.

Если данные уже ранжированы (например, оценки от 1 до 5), то коэффициент Спирмена эквивалентен коэффициенту Пирсона, применённому к рангам.

> Не дописано.