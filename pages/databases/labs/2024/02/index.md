---
prev:
    link: ../01
    text: 1. ER-диаграмма
next:
    link: ../03
    text: 3. SQL (DDL, DCL)
---

**Лабораторная работа 2**

# SQL (DML)

## Варианты

::: warning ВАЖНО
При выполнении данной лабораторной работы нужно обращаться к схеме ``ED_SALES``. Её можно найти в SQL Developer в разделе "Other Users".
:::

### Вариант 1

1. Покажите все должности всех сотрудников (простой запрос, таблица сотрудники).
2. Выведите всех сотрудников и номер отделения, в котором они работают (простой запрос, таблица сотрудники).
3. Отыщите фамилии, номера отделений и должности сотрудников, которые работают в отделении 10 (where, таблица сотрудники).
4. Представьте из таблицы Сотрудников список месячной и годовой заработной платы всех клерков и менеджеров (where, таблица сотрудники).
5. Представьте отсортированный по должности и заработной плате список персонала. Отсортируйте заработную плату по убыванию (order by, таблица сотрудники)
6. Вычислите уровень гарантированной годовой премии как 11% месячной заработной платы. Округлите результат до целой величины (арифметика, таблица сотрудники).
7. Покажите имена всех клиентов, которые имеются в таблице Клиенты. Выведите имена буквами верхнего регистра, буквами нижнего регистра и написав каждое имя с большой буквы (работа с символьными строками).
8. Найдите среднюю заработную плату для каждого отдела.* (group by, таблица сотрудники).
9. Покажите отделы с более, чем тремя сотрудниками. Вывести номер отдела и количество сотрудников (group by, таблица сотрудники).
10. Найдите среднюю заработную плату сотрудников для каждого отдела (функции группировки, таблица сотрудники).
11. Какая расходная сумма для предприятия, полученная суммированием заработных плат всех клерков и аналитиков? Выведите только сумму (функции группировки, таблица сотрудники).
12. Следует показать общее количество различных профессий, которые имеются в отделениях 20 и 30. Выведите только найденное число (функции группировки, таблица сотрудники).
13. Сформируйте список сотрудников, которые работают у Блейка, исключая Тюрнера (иерархический запрос, таблица сотрудники).
14. Составьте список номеров, имён и кредитов всех клиентов, которые имеют кредит от 3000$ и выше (комбинированный запрос, таблица клиенты).
15. Покажите номера всех продуктов, их описание, действующий прайслист и минимальную цену. Используйте таблицы Продукты и Цены (объединение таблиц).
16. Представьте список служащих, которые к 1993 году проработали на этой фирме более 12 месяцев.


### Вариант 2

1. Выведите список всех отделов (простой запрос, таблица «ED_SALES.Отделы»).
2. Отыщите фамилию, дату приёма на работу, заработную плату и надбавки для каждого сотрудника (простой запрос, таблица «ED_SALES.Сотрудники»).
3. Отберите имя, заработную плату и персональный номер всех служащих, исключая того, который зарабатывает 5000$ (where, таблица «ED_SALES.Сотрудники»).
4. Какие сотрудники работают либо клерками либо менеджерами в отделении 20 или 10? (where, таблица «ED_SALES.Сотрудники»).
5. Представьте отсортированный список заказов по убыванию дат заказов. Выведите все данные, кроме комментария. Используйте при этом таблицу «ED_SALES.Заказы».(order by).
6. Выведите список со всей информацией обо всех служащих, которые имеют нечётные персональные номера (арифметика, таблица «ED_SALES.Сотрудники»).
7. Составьте список, в котором отражены имена клиентов и показано, в какой позиции первый раз встретилась буква "О", начиная с первой буквы имени. Используйте таблицу Клиенты (работа с символьными строками, таблица «ED_SALES.Сотрудники»).
8. Как  высока сумма окладов для каждой профессии.(group by, таблица «ED_SALES.Сотрудники»).
9. Покажите, сколько человек выполняют отдельную работу и зарабатывают более 1500$ (group by, таблица «ED_SALES.Сотрудники»).
10. Установите высшую и низшую заработную плату, выплачиваемую служащим каждого отдела. Рассчитайте разницу между ними (функции группировки, таблица «ED_SALES.Сотрудники»).
11. Сформируйте список, который содержит количество человек по роду деятельности в соответствующем отделе (функции группировки, таблица «ED_SALES.Сотрудники»).
12. Отыщите по таблице «ED_SALES.Заказы» общее проданное количество каждого продукта. Отсортируйте результат по этому количеству в порядке убывания (функции группировки).
13. Создайте список всех сотрудников, в котором отсутствуют Кларк и Блейк. Также не следует выводить сотрудников, которые работают у Блейка (иерархический запрос, таблица «ED_SALES.Сотрудники»).
14. Представьте список, в который отбирается дополнительная информация о теннисных продуктах из таблицы «ED_SALES.Продукты» (комбинированный запрос)
15. Укажите имена всех служащих и всю информацию об отделах, в которых они работают (объединение таблиц, таблицы «ED_SALES.Сотрудники» и «ED_SALES.Отделы»).
16. Представьте список служащих, которые к 1993 году проработали на этой фирме более 12 месяцев.


### Вариант 3

1. Покажите все разнообразные профессии (простой запрос, таблица «ED_SALES.Сотрудники»).
2. Измените предыдущий запрос так, чтобы вместо даты приёма на работу отображался номер отдела, в котором работает сотрудник (простой запрос, таблица «ED_SALES.Сотрудники»).
3. Кто работает в отделении 10 или 30. Выдайте из таблицы «ED_SALES.Сотрудники» имена сотрудников и соответствующие номера отделений (where).
4. Отыщите сотрудников, которые зарабатывают между 2500 и 3000$ (where, таблица «ED_SALES.Сотрудники»).
5. Представьте отсортированный по убыванию номера продукта и по возрастанию минимальной цены список, в котором вся информация выводится из таблицы «ED_SALES.Цены».(order by).
6. Покажите заработную плату служащих, округлённую с точностью до 1000.(арифметика, таблица «ED_SALES.Сотрудники»).
7. Выведите из таблицы «ED_SALES.Сотрудники» имена сотрудников, а также ещё один столбец, в котором каждая появляющаяся в имени "Л" была бы заменена на "Х".(работа с символьными строками).
8. Сколько сотрудников имеется по каждому роду деятельности (group by, таблица «ED_SALES.Сотрудники»).
9. Найдите суммы всех заработных плат по отделам. При этом продавцов и президента не принимать во внимание.(group by, таблица «ED_SALES.Сотрудники»).
10. Рассчитайте общую и среднюю заработную плату для каждой группы профессий по отделам (функции группировки, таблица «ED_SALES.Сотрудники»).
11. Установите, в каких отделах более, чем два человека занимаются одним видом деятельности (функции группировки, таблица «ED_SALES.Сотрудники»).
12. Найдите общую сумму по каждому заказу. Используйте таблицу «ED_SALES.Позиции» (функции группировки).
13. Представьте список текущих кредитов свыше 4500\$. Дополнительный столбец должен отражать увеличенный на 500\$ кредит клиента (комбинированный запрос, таблица «ED_SALES.Клиенты»).
14. Отыщите имена служащих и их место работы за исключением тех, которые работают в отделе продаж.(объединение таблиц, таблицы «ED_SALES.Сотрудники» и «ED_SALES.Клиенты»).
15. Покажите имена, уровень и заработок сотрудников (объединение таблиц, таблицы «ED_SALES.Сотрудники» и «ED_SALES.Уровни_зарплаты»).


### Вариант 4

1.  Выведите все разнообразные фамилии сотрудников (Простой запрос, таблица «ED_SALES.Сотрудники»).
2.  Выведите всех сотрудников, номер отделения, в котором они работают и должности каждого сотрудника (Простой запрос, таблица «ED_SALES.Сотрудники»).
3.  Отыщите фамилии, номера отделений и должности сотрудников, которые работают в отделении 20 (where, таблица «ED_SALES.Сотрудники»).
4.  Представьте из таблицы Сотрудников список месячной и годовой заработной платы всех продавцов и аналитиков (where, таблица «ED_SALES.Сотрудники»).
5.  Представьте отсортированный по дате приема и должности список персонала. Отсортируйте дату приема по возрастанию (order by, таблица «ED_SALES.Сотрудники»)
6.  Вычислите уровень гарантированной месячной премии как 10% надбавки к заработной плате, у которых она есть. Округлите результат до целой величины (Арифметика, таблица «ED_SALES.Сотрудники»).
7.  Выведите все названия отделов, которые имеются в таблице «ED_SALES.Отделы». Выведите названия отделов буквами верхнего регистра, буквами нижнего регистра и написав каждое название с большой буквы (Работа с символьными строками)(6.1).
8.  Найдите среднюю заработную плату для каждого отдела.(group by, таблица «ED_SALES.Сотрудники»).
9. Покажите отделы, где работают менее четырех человек. Вывести номер отдела и количество сотрудников (group by, таблица «ED_SALES.Сотрудники»).
10. Найдите максимальную заработную плату, учитывая месячные надбавки, сотрудников для каждого отдела (Функции группировки, таблица «ED_SALES.Сотрудники»).
11. Какая расходная сумма для предприятия, полученная суммированием заработных плат всех операционистов и кассиров? Выведите только сумму (Функции группировки, таблица «ED_SALES.Сотрудники»).
12. Следует показать общее количество различных профессий, которые имеются в отделениях 10 и 40. Выведите только найденное число (Функции группировки, таблица «ED_SALES.Сотрудники»).
13. Сформируйте список сотрудников, которые работают у Мартинса, исключая Харда (иерархический запрос, таблица «ED_SALES.Сотрудники») .
14. Составьте список номеров, имён и кредитов всех клиентов, которые имеют кредит от 3500$ и выше (Комбинированный запрос, таблица клиенты).
15. Покажите номера продуктов, относящихся к Футболу, их описание, действующий прайслист и минимальную цену. Используйте таблицы «ED_SALES.Продукты» и «ED_SALES.Цены».(объединение таблиц).
16. Представьте список служащих, которые к 1998 году проработали на этой фирме менее  1 года (таблица «ED_SALES.Сотрудники»).


### Вариант 5

1. Выведите список всех клиентов (простой запрос, таблица «ED_SALES.Клиенты»).
2. Отыщите должность, фамилию и дату приёма на работу для каждого сотрудника (простой запрос, таблица «ED_SALES.Сотрудники»).
3. Выведите имена сотрудников, заработную плату и персональный номер всех служащих, исключая тех, кто зарабатывает больше 4000$ (where, таблица «ED_SALES.Сотрудники»).
4. Какие сотрудники работают либо клерками либо операционистами в отделении 20 или 40? (where, таблица «ED_SALES.Сотрудники»).
5. Представьте отсортированный список заказов по возрастанию дат заказов, исключая клиентов (ЛЕОСТАР, ИНТЕРСПОРТ) Выведите все данные, где есть комментарий. Используйте при этом таблицу «ED_SALES.Заказы».(order by).
6. Выведите список со всей информацией обо всех служащих, которые имеют чётные персональные номера (арифметика, таблица «ED_SALES.Сотрудники»).
7. Составьте список, в котором отражены имена клиентов и показано, в какой позиции первый раз встретилась буква "И", начиная с первой буквы имени. Используйте таблицу Клиенты (работа с символьными строками, таблица «ED_SALES.Сотрудники»).
8. Как  высока сумма окладов для каждой профессии.(group by, таблица «ED_SALES.Сотрудники»).
9. Покажите, сколько человек выполняют совместную работу и зарабатывают более 2000$ (group by, таблица «ED_SALES.Сотрудники»).
10. Установите высшую и низшую заработную плату, выплачиваемую служащим каждого отдела. Рассчитайте разницу между ними (функции группировки, таблица «ED_SALES.Сотрудники»).
11. Сформируйте список, который содержит количество человек по роду деятельности в отделах 10 и 40 (where + функции группировки, таблица «ED_SALES.Сотрудники»).
12. Отыщите по таблице «ED_SALES.Заказы» максимальное проданное количество каждого продукта. Отсортируйте результат по этому количеству в порядке возрастания (функции группировки).
13. Создайте список всех сотрудников, в котором отсутствуют Турс и Джонс. Также не следует выводить сотрудников, которые работают у Кларка (иерархический запрос, таблица «ED_SALES.Сотрудники»).
14. Представьте список, в который отбирается дополнительная информация о футбольных продуктах из таблицы «ED_SALES.Продукты» (комбинированный запрос)
15. Укажите имена всех служащих и всю информацию об отделах, в которых они работают, исключая отдел «Продаж» (where, объединение таблиц, таблицы «ED_SALES.Сотрудники» и «ED_SALES.Отделы»).
16. Представьте список служащих, которые к 1994 году проработали на этой фирме более 12 месяцев.


### Вариант 6

1. Покажите все разнообразные должности (простой запрос, таблица «ED_SALES.Сотрудники»).
2. Измените предыдущий запрос так, чтобы вместо оклады отображалась надбавка и отдел, в котором работает сотрудник (простой запрос, таблица «ED_SALES.Сотрудники»).
3. Кто работает в отделении 40. Выведите из таблицы «ED_SALES.Сотрудники» имена сотрудников и соответствующие должности (where).
4. Отыщите должности, которые зарабатывают менее 2500 и более 3000$ (where, таблица «ED_SALES.Сотрудники»).
5. Представьте отсортированный по возрастанию минимальной цены  и по убыванию даты начала список, в котором вся информация выводится из таблицы «ED_SALES.Цены» (order by).
6. Выведите полугодовую среднюю заработную плату служащих, округлённую с точностью до 1000 (арифметика, таблица «ED_SALES.Сотрудники»).
7. Выведите из таблицы «ED_SALES.Сотрудники» имена сотрудников, а также ещё один столбец, в котором каждая появляющаяся в имени "К" была бы заменена на "С" (работа с символьными строками).
8. Сколько сотрудников имеется по каждому роду деятельности (group by, таблица «ED_SALES.Сотрудники»).
9. Найдите суммы всех заработных плат по отделам. При этом кассиров и менеджеров не принимать во внимание.(group by, таблица «ED_SALES.Сотрудники»).
10. Рассчитайте общую и среднюю заработную плату для каждой группы профессий по отделам (функции группировки, таблица «ED_SALES.Сотрудники»).
11. Установите, в каких отделах менее, чем трое людей занимаются одним видом деятельности (функции группировки, таблица «ED_SALES.Сотрудники»).
12. Найдите заказы и общую сумму по каждому заказу, где количество позиций, более чем одна. Используйте таблицу «ED_SALES.Позиции» (функции группировки).
13. Представьте список текущих кредитов свыше 5000\$. Дополнительный столбец должен отражать увеличенный на 1500\$ кредит клиента (комбинированный запрос, таблица «ED_SALES.Клиенты»).
14. Отыщите имена служащих и их место работы за исключением тех, которые работают в отделе бухгалтерии (объединение таблиц, таблицы «ED_SALES.Сотрудники» и «ED_SALES.Клиенты»).
15. Покажите имена, уровень и заработок сотрудников (объединение таблиц, таблицы «ED_SALES.Сотрудники» и «ED_SALES.Уровни_зарплаты»).


## Защита

Ниже приведены вопросы, которые задавались во время защиты лабораторной работы.

::: details Рассказать про оператор JOIN (соединения)
**JOIN** в SQL — это оператор, который позволяет объединять данные из двух или более таблиц на основе определенных условий. Это особенно полезно, когда данные, которые вы хотите получить, распределены по нескольким таблицам в базе данных.

Основные типы JOIN:
* *INNER JOIN (внутреннее соединение):* Этот тип соединения возвращает только те записи, которые имеют совпадения в обеих таблицах. Если в одной из таблиц нет соответствующих записей, то такие строки не будут включены в результат.
* *LEFT JOIN* (или *LEFT OUTER JOIN*): Возвращает все записи из левой таблицы и совпадающие записи из правой таблицы. Если в правой таблице нет совпадений, то результат будет содержать NULL для столбцов правой таблицы.
* *RIGHT JOIN* (или *RIGHT OUTER JOIN*): Работает аналогично LEFT JOIN, но возвращает все записи из правой таблицы и совпадающие записи из левой.
* *FULL JOIN* (или *FULL OUTER JOIN*): Возвращает записи, когда есть совпадения в одной из таблиц. Если совпадений нет, то в соответствующих столбцах будет NULL.
* *CROSS JOIN:* Создает декартово произведение двух таблиц, возвращая все возможные комбинации строк из обеих таблиц.
* *SELF JOIN:* Это соединение таблицы самой с собой. Оно используется, когда необходимо сравнить строки в одной таблице.
:::

::: details Рассказать, что такое иерархический запрос и как он работает. Описание синтаксиса иерархического запроса

**Иерархический запрос** — это тип SQL-запроса, который используется для обработки данных, организованных в иерархическую модель. Эти запросы позволяют извлекать данные, которые имеют структуру дерева, например, организационные структуры, каталоги или семейные деревья.

В Oracle для формирования иерархического запроса используются операторы ``START WITH`` и ``CONNECT BY``:
* в ``START WITH`` указывается критерий, по которому определяется первый уровень иерархи (т. е. с чего начинать перебирать);
* в ``CONNECT BY`` указывается правило, которое задаёт иерархию.

Слово ``PRIOR`` используется для того, чтобы обратиться к предыдущей по иерархии записи.

Пример иерархического запроса: Сформируйте список сотрудников, которые работают у Блейка, исключая Тюрнера.

```sql
SELECT *
FROM ED_SALES.сотрудники
WHERE фамилия = 'БЛЕЙК'
START WITH фамилия = 'БЛЕЙК'
CONNECT BY PRIOR ном_сотр = ном_нлнк AND фамилия != 'ТЮРНЕР';
```

Здесь запись ``PRIOR ном_сотр = ном_нлнк`` означает, что номер предыдущего по иерархии сотрудника должен совпадать с номером начальника текущего рассматриваемого элемента.
:::

::: details Разница между WHERE и HAVING
``WHERE`` используется для фильтрации строк в таблице и до их группировки (через ``GROUP BY``), а ``HAVING`` — для фильтрации групп.

Например, если нужно выбрать все записи из таблицы, где значение в определённом столбце больше 10, то нужно использовать ``WHERE``:

```sql
SELECT * FROM table_name
WHERE column_name > 10;
```

Если же нужно, например, выбрать группы, где сумма значений в определённом столбце превышает 100, то нужно использовать ``HAVING``:

```sql
SELECT emp_id, SUM(salary)
FROM table
GROUP BY emp_id
HAVING SUM(salary) > 100;
```

Говоря о порядке выполнения, ``WHERE`` выполняется первым, и только после этого происходит группировка данных, а затем к результатам этой группировки применяется ``HAVING``.
:::

::: details Как отсортировать данные по возрастанию и по убыванию?
Использовать ключевое слово ``ORDER BY`` и параметры ``ASC`` (по возрастанию) и ``DESC`` (по убыванию).
:::