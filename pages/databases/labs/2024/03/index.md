---
prev:
    link: ../02
    text: 2. SQL (DML)
next:
    link: ../04
    text: 4. PL/SQL
---

**Лабораторная работа 3**

# SQL (DDL, DCL)

## Варианты

### Вариант 1

1. Создать таблицу *Salespeople* (Продавцы)

| № п/п | Имя столбца | Описание | Тип данных | Ограничения целостности |
|-|-|-|-|-|
| 1 | snum | код продавца | integer | первичный ключ |
| 2 | sname | имя продавца | char(10) | |
| 3 | city | место проживания | char(10) | |
| 4 | comm | коммисионные от сделки | float | пустые значения запрещены, по умолчанию 10% |

2. Создать таблицу *Customer* (Покупатели)

| № п/п | Имя столбца | Описание | Тип данных | Ограничения целостности |
|-|-|-|-|-|
| 1 | cnum | код покупателя | integer | первичный ключ |
| 2 | cname | имя покупателя | char(10) | |
| 3 | city | место проживания | char(10) | |
| 4 | rating | покупательная способность | integer | |
| 5 | snum | код продавца | integer | не пусто |

3. Создать таблицу *Orders* (Заказы)

| № п/п | Имя столбца | Описание | Тип данных | Ограничения целостности |
|-|-|-|-|-|
| 1 | onum | код заказа | integer | первичный ключ |
| 2 | amt | сумма заказа | float | |
| 3 | odate | дата заказа | date | |
| 4 | cnum | код покупателя | integer | внешний ключ |
| 5 | snum | код продавца | integer | внешний ключ |

4. Указать для таблицы *Customer* внешний ключ (*snum*) и задать ограничение — код покупателя должен быть больше кода продавца.

5. Добавить в таблицу *Orders* ограничение — дата заказа не должна быть пустой.

6. Вставить в таблицы следующие значения:

| snum | sname | city | comm |
|-|-|-|-|
| 1001 | Иванов | Москва | 0.12 |
| 1002 | Петров | Петербург | 0.13 |
| 1004 | Сидоров | Москва | 0.11 |
| 1007 | Федоров | Рига | 0.10 |

| cnum | cname | city | rating | snum |
|-|-|-|-|-|
| 2001 | Белов | Москва | 100 | 1001 |
| 2003 | Чернов | Петербург | 200 | 1002 |
| 2004 | Васильев | Киев | 300 | 1002 |
| 2008 | Краснов | Петербург | 500 | 1007 |

| onum | amt | odate | cname | snum |
|-|-|-|-|-|
| 3001 | 18.69 | 10.03.1990 | 2008 | 1007 |
| 3003 | 767.19 | 10.03.1990 | 2001 | 1001 |
| 3007 | 75.75 | 10.04.1999 | 2004 | 1002 |
| 3005 | 5160.45 | 21.05.1999 | 2003 | 1002 |

Осуществить ввод первой строки в талицу *Orders* в заданном порядке.

7. Увеличить рейтинг всех покупателей в Петербург на 100.

8. Продавец Петров покинул компанию. Перевести всех его покупателей продавцу Сидорову.

9. Создать пользователей *user1*, *user2*, *user3*, *user4*.

10. Дать право пользователю *user1* просматривать таблицу продавцов и менять их рейтинги.

11. Передать от пользователя *user2* пользователю *user3 право формулировать запросы к таблице Orders*.

12. Передать право user4 выполнять вставку и обновление таблицы Customer для покупателей, рейтинг которых лежит в интервале от 100 до 300.

13. Разрешить *user1* просматривать всех покупателей кроме тех, которые имеют самый низкий рейтинг


### Вариант 2

1. Создать таблицу *Альбом*

| № п/п | Имя столбца | Описание | Тип данных | Ограничения целостности |
|-|-|-|-|-|
| 1 | код_альб | код альбома | integer | первичный ключ |
| 2 | назв_альб | название альбома | char(50) | |
| 3 | издат | издатель альбома | char(50) | |
| 4 | дата_изд | дата издания | date | пустые значения запрещены |

2. Создать таблицу *Песня*

| № п/п | Имя столбца | Описание | Тип данных | Ограничения целостности |
|-|-|-|-|-|
| 1 | код_песни | код песни | integer | первичный ключ |
| 2 | наз_песни | название песни | char(50) | |
| 3 | автор | автор песни | char(50) | |
| 4 | год | год написания | integer | |
| 5 | стиль | стиль музыки | char(30) | |

3. Создать таблицу *Песня из альбома*

| № п/п | Имя столбца | Описание | Тип данных | Ограничения целостности |
|-|-|-|-|-|
| 1 | код_общ | код песни в альбоме | integer | первичный ключ |
| 2 | длител | длительность | float | |
| 3 | номер | номер | integer | |
| 4 | код_песни | код песни | integer | внешний ключ |
| 5 | код_альб | код альбома | integer | внешний ключ |

4. Для таблицы *Песня* задать ограничение -  стиль должен быть принимать одно из следующих значений: рок, кантри, романс, авторская песня, блюз, классика.

5. Добавить в таблицу *Песня из альбома* ограничение - номер не должен быть пустым, по умолчанию 1.

6. Вставить в таблицы следующие значения:

| код_альб | назв_альб | издат | дата_изд |
|-|-|-|-|
| 1001 | Встреча друзей | Мелодия | 01.01.88 |
| 1002 | Gerry Mulligan | Balkanton | 07.09.90 |
| 1004 | Антология | Мелодия | 09.12.90 |
| 1007 | А. Шнитке | Мелодия | 10.05.91 |

| код_песни | наз_песни | автор | год | стиль |
|-|-|-|-|-|
| 2001 | Альма-матер | В. Берковский | 1970 | авторская песня |
| 2003 | Балла о совести | Ю. Ким | 1967 | авторская песня |
| 2004 | Щелкунчик | П. Чайковский | 1892 | классика |
| 2008 | G. Mulligan | Blue theme | 1961 | блюз |

| код_общ | длител | номер | код_песни | код_альб |
|-|-|-|-|-|
| 3001* | 5.35 | 3 | 2008 | 1002 |
| 3003 | 2.55 | 7 | 2001 | 1001 |
| 3007 | | | 2004 | 1004 |
| 3005 | 2.23 | 5 | 2003 | 1001 |

&nbsp;* Осуществить ввод первой строки в таблицу  *Песня из альбома* в следующем  порядке: *код_песни*, *код_альб*, *номер*, *длител*, *код_общ*.

7. Увеличить длительность всех песен из альбома Встреча друзей  на 2 мин.

8. Код альбома «Встреча друзей» изменился на 1005. Внести соответствующие поправки в базу.

9. Создать пользователей *user1*, *user2*, *user3*, *user4*.

10. Дать право пользователю *user1* просматривать таблицу *Альбомы* и менять даты издания.

11. Передать от пользователя *user2* пользователю *user3* право формулировать запросы к таблице *Песня из альбома*.

12. Передать право *user4* выполнять вставку и обновление таблицы *Песня* для песен, год написания которых лежит в интервале от 1800 до 1965.

13. Разрешить *user1* просматривать все песни из альбома кроме тех, которые имеют самый короткое время звучания.


### Вариант 3


### Вариант 4


### Вариант 5


### Вариант 6



## Защита

Ниже приведены вопросы, которые задавались во время защиты лабораторной работы.

::: details Что такое DDL и DML? Какие операторы к ним относятся?

К DDL относятся такие операторы, как ``CREATE``, ``ALTER``, ``DROP``, ``TRUNCATE`` и т. д. К DML относятся такие операторы, как ``SELECT``, ``INSERT``, ``UPDATE``, ``DELETE`` и т. д.
:::

::: details Какой оператор позволяет удалить все строки в таблице, не удаляя саму таблицу?

Оператор ``TRUNCATE``.

Можно использовать и ``DELETE FROM table_name``, но ``TRUNCATE`` работает быстрее.
:::

::: details Как происходит выдача и отнятие прав пользователей? Описание синтаксиса используемых операторов.

Для выдачи прав пользователю используется оператор ``GRANT``, а для отнятия — оператор ``REVOKE``.
:::

::: details Как выдать права на взаимодействие только части таблицы?
Для этого можно создать представление (view), а затем его использовать при выдаче/отнятии прав.

*Пример.* Разрешить пользователю *user1* выполнять вставку в таблицу «Песня» новых строк и её обновление для песен, год написания которых лежит в интервале от 1800 и 1965.

```sql
CREATE VIEW песня_view AS
SELECT * FROM песня
WHERE год BETWEEN 1800 AND 1965;

GRANT INSERT, UPDATE ON песня_view TO user1;
```
:::

::: details Какие операторы позволяют задать ограничение на значения в столбце?

* ``UNIQUE`` — в столбце могут находиться только уникальные значения (не могут повторяться);
* ``NOT NULL`` — столбец не может содержать пустые ячейки;
* ``DEFAULT`` — задаёт значение по умолчанию;
* ``CHECK`` — позволяет задать условие для значений столбца;
* ``PRIMARY KEY``, ``FOREIGN KEY``.
:::