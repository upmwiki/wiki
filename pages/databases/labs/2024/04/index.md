---
prev:
    link: ../03
    text: 3. SQL (DDL, DCL)
next:
    link: ../05
    text: 5. XML
---

**Лабораторная работа 4**

# PL/SQL

## Варианты

### Вариант 1

1. Написать процедуру, выполняющую следующую операцию:
   > Для клиента определяется продавец, заключивший максимальное количество сделок. 
   >
   > Во всех заказах клиента проставляется этот продавец.
   >
   > Если несколько продавцов имеют для клиента одинаковое количество сделок, то без изменений.

2. Написать функцию, вычисляющую значение средней суммы сделок за заданный период для определенного продавца.

3. Написать триггер, вставляющий запись в таблицу *Audit(user_name, date, onum)* при каждой вставке строки в таблицу *Orders*. (функция ``user``, таблица ``dual``)

4. Написать триггер автоматически устанавливающий уникальное значение cnum при вставке в таблицу *Customers*. (последовательности (sequence))

5.	Добавить в таблицу *Customer* столбец *ord_number*.

    Написать триггер, увеличивающий на единицу значение этого столбца при вставке записи в таблицу *Orders*.


### Вариант 2

1. Написать процедуру, выполняющую следующую операцию:
   > Создать альбом из трех песен которые наиболее часто встречаются в других альбомах.

2. Написать функцию, вычисляющую отношение продолжительности звучания определенного альбома к средней величине продолжительности звучания альбома.

3. Написать триггер, вставляющий запись в таблицу *Аудит(имя_польз, дата, код_альб)* при каждой вставке строки в таблицу *Альбом*. (функция ``user``, таблица ``dual``)

4. Написать триггер, автоматически устанавливающий уникальное значение *код_альб* при вставке в таблицу *Альбом*. (последовательности (sequence))

5. Добавить в таблицу *Альбом* столбец *кол_песен*.
   
   Написать триггер, увеличивающий на единицу значение этого столбца при вставке записи в таблицу *Песня_из_альбома*.


### Вариант 3

1. Написать процедуру, выполняющую следующую операцию:
   > Для двух любых помещений поменять их виды местами при условии, что они находятся в одном здании.

2. Написать функцию, вычисляющую значение средней площади помещений за заданный период для определенного здания.

3. Написать триггер, вставляющий запись в таблицу *UserData (user_name, date, id_building)* при каждой вставке строки в таблицу *Building*. (функция ``user``, таблица ``dual``)

4. Написать триггер автоматически устанавливающий уникальное значение *id_building* и *id_premises* при вставке в таблицу *Building* и *Premises*. (последовательности (sequence))

5. Добавить в таблицу *Premises* столбец *prem_number*.

   Написать триггер, увеличивающий на единицу значение этого столбца при вставке записи в таблицу *Kind_premises*.


### Вариант 4

1. Написать процедуру, выполняющую следующую операцию:
   > Заселить человека в комнату:
   > * если у человека есть текущее проживание, то выселить его с предыдущей комнаты;
   > * если предыдущего проживания нету – заселить в любую свободную комнату.

2. Написать функцию, вычисляющую количество свободных комнат, по выбранному зданию на указанную дату.

3. Написать триггер, устанавливающий значение поля *id_bas_sal_date* на текущую дату при добавлении записи в *Residing*.

4. Написать триггер автоматически устанавливающий уникальное значение *id_settling* при вставке в таблицу *Settling*. (последовательности (sequence))

5. Добавить в таблицу Warrant столбец *Kol_war*.

   Написать триггер, увеличивающий на единицу значение этого столбца при вставке записи в таблицу *Settling*.


### Вариант 5

1. Написать функцию, вычисляющую значение средней суммы сделок за заданный период для всех продавцов.

2. Написать триггер, вставляющий запись в таблицу *UserSample (user_name, date, cnum)* при каждой вставке строки в таблицу *Customer*. (функция ``user``, таблица ``dual``)

3. Написать триггер, автоматически устанавливающий уникальное значение onum при вставке в таблицу *Orders*. (последовательности (sequence))

4. Добавить в таблицу *Salespeople* столбец *sal_number*.

   Написать триггер, увеличивающий на единицу значение этого столбца при вставке записи в таблицу *Orders*.

5. Написать процедуру, выполняющую следующую операцию:

   > Для клиента определяется продавец, заключивший минимальное количество сделок.
   >
   > Во всех заказах клиента проставляется этот продавец.
   >
   > Если несколько продавцов имеют для клиента одинаковое количество сделок, то выбрать того продавца, у которого в имени больше букв.


### Вариант 6

1. Написать триггер, автоматически устанавливающий уникальное значение *id_building* при вставке в таблицу *Building*. (последовательности (sequence))

2. Написать функцию, вычисляющую значение общей площади всех помещений за заданный период для всех зданий.

3. Написать процедуру, выполняющую следующую операцию:
Для двух любых зданий поменять их виды местами при условии, что поле примечание (*Building.b_note*) не пусто.

4. Написать триггер, вставляющий запись в таблицу *UsersSampleData (user_name, date, id_premises)* при каждой вставке строки в таблицу *Premises*. (функция ``user``, таблица ``dual``)

5. Добавить в таблицу *Building* столбец *build_number*.

   Написать триггер, увеличивающий на единицу значение этого столбца при вставке записи в таблицу *Kind_building*.


## Защита

Ниже приведены вопросы, которые задавались во время защиты лабораторной работы.

::: details Какие существуют виды блоков PL/SQL?
:::

::: details Что означает команда ``for each row`` в триггере? Для чего она нужна? Если ли другие команды помимо неё?
:::

::: details Для чего в триггерах используются такие операторы, как ``:new``, ``:old``? Что это такое и как они работают?
:::