---
prev:
    link: ../04
    text: 4. SQL (PL/SQL)
next:
    link: ../06
    text: 6. Работа с бинарными и сильноветвящимися деревьями
---

**Лабораторная работа 5**

# XML

## Варианты

::: warning ВАЖНО
При выполнении данной лабораторной работы нужно обращаться к схеме ``ED_SALES``. Её можно найти в SQL Developer в разделе "Other Users".
:::

### Вариант 1

Сформировать XML-документ со следующей структурой.

```xml
<Заказы>
    <Заказ номер="ИД ЗАКАЗА" клиент="ИМЯ ИЛИ НОМЕР КЛИЕНТА">
        <Позиция номер="НОМЕР ПОЗИЦИИ ЗАКАЗА" количество="КОЛИЧЕСТВО КУПЛЕННОГО ТОВАРА" цена="ЦЕНА ТОВАРА">НАИМЕНОВАНИЕ ИЛИ ИД ТОВАРА</Позиция>
        ...
        ...
    </Заказ>
    ...
    ...
</Заказы>
```

### Вариант 2

Сформировать XML-документ со следующей структурой.

```xml
<Отделы>
    <Отдел номер="НОМЕР ОТДЕЛА" название="НАИМЕНОВАНИЕ">
        <Сотрудник номер="НОМЕР СОТРУДНИКА" уровень_оплаты="УРОВЕНЬ ЗАРПЛАТЫ">ИМЯ СОТРУДНИКА</Сотрудник >
        ...
        ...
    </Отдел>
    ...
    ...
</Отделы>
```

### Вариант 3

Сформировать XML-документ со следующей структурой.

```xml
<Продукты>
    <Продукт номер="НОМЕР ПРОДУКТА" название="НАИМЕНОВАНИЕ">
        <Цена дата_начала="ДАТА НАЧАЛА ДЕЙСТВИЯ ЦЕНЫ" дата_окончания="ДАТА ОКОНЧАНИЯ ДЕЙСТВИЯ ЦЕНЫ">РОЗНИЧНАЯ ЦЕНА</Цена>
        ...
        ...
    </Продукт>
    ...
    ...
</Продукты>
```

### Вариант 4

Сформировать XML-документ со следующей структурой.

```xml
<Клиенты>
    <Клиент номер="ИМЯ ИЛИ НОМЕР КЛИЕНТА">
        <Заказ номер="НОМЕР ЗАКАЗА" дата_заказа="ДАТА ЗАКАЗА" дата_доставки="ДАТА ДОСТАВКИ">НОМЕР СЧЕТА</Заказ>
        ...
        ...
        </Клиент>
    ...
    ...
</Клиенты>
```


### Вариант 5

Сформировать XML-документ со следующей структурой.

```xml
<Уровни зарплаты>
    <Уровень нижний_предел="НИЖНИЙ ПРЕДЕЛ" верхний_предел="ВЕРХНИЙ ПРЕДЕЛ">
        <Сотрудник номер="НОМЕР СОТРУДНИКА" должность="ДОЛЖНОСТЬ">ИМЯ СОТРУДНИКА</Сотрудник>
        ...
        ...
    </Уровень зарплаты>
    ...
    ...
</Уровни зарплаты>
```


### Вариант 6

Сформировать XML-документ со следующей структурой.

```xml
<Должности>
    <Должность название="ДОЛЖНОСТЬ">
        <Сотрудник номер="НОМЕР СОТРУДНИКА" номер_отдела="НОМЕР ОТДЕЛА" >ИМЯ СОТРУДНИКА</Сотрудник>
        ...
        ...
    </Должность>
    ...
    ...
</Должности>
```

## Методические указания
* https://docs.oracle.com/cd/E11882_01/appdev.112/e23094/xdb13gen.htm#ADXDB4994 — подробная офф. документация по работе с XML с примерами
* http://citforum.ru/database/oracle/xml-oracle/ — пункт "Преобразование из табличной формы в XMLTYPE" с примерами

## Защита

::: details В чём разница между элементами и атрибутами?

В XML *элементы* позволяют описать сущности (какие-то объекты), а *атрибуты* — их свойства.

Например, если нужно представить информацию о сотруднике в виде XML-документа, то это можно сделать следующим образом:

```xml
<Сотрудник номер_сотрудника="123456" номер_отдела="15">
    Иванов Иван Иванович
</Сотрудник>
```

Здесь сам сотрудник описывается путём создания элемента ``<Сотрудник>``, а информация о сотруднике (его свойства), такая как его номер и номер его отдела, представлена в виде атрибутов.

В Oracle SQL создать элемент можно при помощи функции ``XMLELEMENT``, а добавить атрибут для него — с помощью функции ``XMLATTRIBUTE``.
:::

::: details Как работает конструкция ``XMLAGG``? Использование группировки вместе с ``XMLAGG``.
:::

::: details Что такое ``XMLFOREST`` и ``XMLELEMENT`` и в чём разница между ними?
:::

::: details Что такое ``XMLATTRIBUTES`` и ``XMLELEMENT`` и в чём разница между ними, куда записываются их данные?
:::

::: details Как проверить, пустой ли ``XMLELEMENT``? Какие функции для этого нужны?
:::

::: details Что такое ``XMLTYPE``?
Функция ``XMLTYPE`` позволяет представить XML-документ в виде набора столбцов.
:::

::: details Что такое ``XMLROOT``?
Функция ``XMLROOT`` добавляет информацию о составляемом XML-документе, такую как версия XML, используемая кодировка и т. д. в начало этого документа.

Ниже приведён пример того, как может выглядеть подобная информация в XML-файле.

```xml
<?xml version="1.0" encoding="utf-8" ?>
```
:::

:::: details Как преобразовать XMLTYPE в XML-строку?
Использовать ``getClobVal()``.

```sql
SELECT xml_column.getClobVal() AS xml_string
FROM table;
```

::::