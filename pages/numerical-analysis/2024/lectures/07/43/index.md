---
prev:
    text: § 42. Формулы Ньютона-Котеса
    link: ../42
next:
    text: § 44. Квадратурные формулы Гаусса
    link: ../44
---

**Тема 7. Численное интегрирование**

# § 43. Применение формул Ньютона-Котеса

Вроде вы качество квадратурных формул определяется степенью $h$ в её остаточном члене. Однако это не всё.

* Для того, чтобы формула Симпсона выдерживала заявленную точность, необходимо, чтобы $f(x)$ была четырежды непрерывно дифференцируема;
* Для формулы трапеций и средних прямоугольников необходимо, чтобы она была дважды непрерывно дифференцируема;
* Для левых и правых прямоугольников достаточно одной производной.

В противном случае оценки достаточных членов будут неверны. Более того, часто бывает, что исходная функция сеточная, и говорить о её гладкости вообще бессмысленно. Поэтому на практике обычно используют несколько формул и в ходе вычислений сравнивают их результат.

Обычно вычисления строятся по следующей схеме:
1. Одна или несколько формул просчитываются с шагом $H$, и получается некоторое значение $S(H)$ ($S$ — квадратурная формула). Затем берётся $\displaystyle h = {H \over 2}$ и вычисляется $S(h)$.
2. Если $|S(H) - S(h)| < \varepsilon$, то $I := S(h)$ (интегралу присваивается $S(h)$), и интеграл считается найденным.
3. Если нет, то $H := h$ ($H$ присваивается $h$), и переходим к пункту 1.

($\varepsilon$ — наперёд заданная точность.)

Такой подход удобен тем, что позволяет вдвое экономить вычисления, т. к. половина суммы квадратурной формулы посчитана на предыдущем шаге.

Рассмотрим совместное использование формул средних прямоугольников, трапеций и Симпсона для таковой системы.

---

В предыдущем разделе были рассмотрены различные квадратурные формулы. Выясним, какие связи существуют между ними.

Рассмотрим сначала интеграл на элементарном участке:

$$
I = \int_{x_i - h}^{x_i + h} f(x) ~ \text{d}x.
$$

[image]

Рассмотрим приближённое значение этого интеграла по формуле прямоугольников с шагом $H$ ($I_i^\text{П}(H)$), по формуле трапеций с шагом $h$ и $H = 2h$ ($I_i^\text{Т}(h)$ и $I_i^\text{Т}(H)$) и по формуле Симпсона с шагом $h$ ($I_i^\text{С}(h)$).

Как следует из рисунка,

$$
I_i^\text{П}(H) = Hy_i = 2hy_i. \tag{1}
$$

$$
I_i^\text{Т}(H) = {y_{i-1} + y_{i+1} \over 2} \cdot H = h (y_{i-1} + y_{i+1}). \tag{2}
$$

$$
I_i^\text{Т}(h) = {y_{i-1} + y_{i} \over 2} \cdot h + {y_{i} + y_{i+1} \over 2} \cdot h = {h \over 2} \left(
    y_{i-1} + 2y_i + y_{i+1}
\right). \tag{3}
$$

$$
I_i^\text{С}(h) = {h \over 3} \left(
    y_{i-1} + 4y_i + y_{i+1}
\right). \tag{4}
$$

Если возьмём полусумму $(1)$ и $(2)$, то получим $(3)$. Следовательно,

$$
I_i^\text{Т}(h) = {1 \over 2} \left( I_i^\text{П}(H) + I_i^\text{Т}(H) \right).
$$

Если же взять эту же сумму с весами $2/3$ и $1/3$, то получим формулу $(4)$. Следовательно,

$$
I_i^\text{С}(h) = {2 \over 3} I_i^\text{П}(H) + {1 \over 3} I_i^\text{Т}(H).
$$

Но тогда для всего интеграла:

$$
I = \int_a^b f(x) ~ \text{d}x = \sum_{i=1}^N I_i,
$$

где $N = {b - a \over H}$. Следовательно, индекс $i$ в последних формулах можно отбросить. Тогда для всего интеграла получаем

$$
I^\text{Т}(h) = {1 \over 2} \left( I^\text{П}(H) + I^\text{Т}(H) \right).
$$

$$
I^\text{С}(h) = {2 \over 3} I^\text{П}(H) + {1 \over 3} I^\text{Т}(H).
$$

::: info Замечание
На основе этих связей можно строить эффективные алгоритмы вычисления интегралов. Суть их состоит в том, что после дробления шага пополам достаточно вычислять значения функций только в точках в середине интервала. Эти новые значения используются для вычисления $I^\text{П}(H)$, тогда как остальные значения функции передаются с предыдущего шага уже в просуммированном виде. В результате можно получить более точное значение $I^\text{Т}(h)$ либо $I^\text{С}(h)$.
:::

$I^\text{С}(h)$ можно также получить по другой формуле:

$$
I^\text{С}(h) = I^\text{Т}(h) + R(h),
$$

где $R(h) = {1 \over 3} \left( I^\text{Т}(h) - I^\text{T}(H) \right)$ — поправка Ричардсона.

Действительно,

$$
I^\text{T}(h) + R(h) = {4 \over 3} I^\text{T}(h) - I^\text{T}(H) =
$$

$$
= {2 \over 3} I^\text{П}(H) + {2 \over 3} I^\text{T}(H) - {1 \over 3} I^\text{T}(H) =
$$

$$
= {2 \over 3} I^\text{П}(H) + {1 \over 3} I^\text{T}(H) = I^\text{С}(h).
$$

Таким образом, пользуясь всеми тремя формулами, мы сокращаем вычисления и увеличиваем скорость сходимости.

## Правило Рунге

Как было показано в предыдущем разделе, остаточный член любой квадратурной формулы имеет порядок $O(h^p)$ при $h \to 0$. Будем называть число $p$ **порядком точности** квадратурной формулы, и если $f(x)$ имеет непрерывные производные до $p$-го порядка включительно, то интеграл представляется в виде

$$
I = I^\text{p}(h) + Ch^p,
\tag{1}
$$

где $C = \text{const}$.

В случае уменьшения шага вдвое этот же интеграл представляется в виде

$$
I = I^\text{p}\left({h \over 2}\right) + C_1\left({h \over 2}\right)^p,
$$

где $C_1 = \text{const}$.

Очевидно, что при $h \to 0$ $C_1 \to C \to C^*$ (т. е. есть некое предельное значение). Тогда, исключая интеграл из обеих равенств, получаем приближённое значение:

$$
C \approx C_1 \approx {
    I^\text{p}\left({h \over 2}\right) - I^\text{p}(h)
    \over
    h^p - \left({h \over 2}\right)^p
}.
$$

Подставим значение $C_1$ в $(2)$, получим, что

$$
I \approx I^\text{p}\left({h \over 2}\right) + 
{
    I^\text{p}\left({h \over 2}\right) - I^\text{p}(h)
    \over
    2^p - 1
}.
$$

Таким образом, данное выражение позволяет оценивать отклоенния точного значения интеграла от текущего, основываясь на пересчёте квадратурной формулы с половинным шагом.

Для квдаратурной формулы порядка $p$ выражение

$$
R^\text{p}\left({h \over 2}\right) = 
{
    I^\text{p}\left({h \over 2}\right) - I^\text{p}(h)
    \over
    2^p - 1
}
$$

называется **обобщённой поправкой Ричардсона**, которая также позволяет контролировать точность выражений.